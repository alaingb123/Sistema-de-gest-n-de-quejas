{% extends 'base.html' %}
{% load static %}
{% block content %}

    <style>
 /* Add the necessary mobile styles here */
  @media (max-width: 767px) {
    table {
      width: 100%; /* Make the table responsive for mobile view */
      margin: 0 auto; /* Center the table horizontally */
    }
    .table td,
    .table th {
      padding: 0.5rem; /* Adjust cell padding for mobile view */
      text-align: center; /* Center the text within cells for mobile view */
    }
    .form-group {
      text-align: center; /* Center the form elements within the table cells for mobile view */
      margin-bottom: 10px; /* Add margin to separate form elements for mobile view */
    }
    .form-check {
      text-align: center; /* Center the form check within the table cells for mobile view */
      margin-top: 10px; /* Add margin to separate form check for mobile view */
    }
    .d-grid {
      text-align: center; /* Center the buttons within the table cells for mobile view */
      margin-top: 10px; /* Add margin to separate buttons for mobile view */
    }
  }
    </style>

    <form method="get" action="{% url 'listar_quejasU' %}" id="filter-form" style="margin-top: 20px">
    {% csrf_token %}


<div class="form-container" style="border: 1px solid rgba(234,13,13,0); border-bottom: 2px solid rgba(255,255,255,0); border-top:2px solid rgba(255,255,255,0); width: 1347px; margin-left: 65px; align-content: center; max-width: 100%">
    <div class="row">
        <div class="col-md-3">
            <div class="form-group" style="">
                <label for="numero" class="form-label" style="color: #1d1e21">Número:</label>
                <input type="text" class="form-control form-control-sm" id="numero" name="numero" value="{{ request.GET.numero }}" pattern="\d+" title="Introduzca un número" maxlength="4" style="background-color: white; color: #1e1f22; border-radius: 0;width: 300px">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group" style="">
                <label for="nombre_apellidos" class="form-label" style="color: #1e1f22">Nombre/Apellidos:</label>
                <input type="text" class="form-control form-control-sm" id="nombre_apellidos" name="nombre_apellidos" value="{{ request.GET.nombre_apellidos }}" maxlength="50" oninput="validateName()" style="background-color: white; color: #1e1f22; border-radius: 0;width: 350px">
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group" style="margin-left: 60px">
                <input class="form-check-input" type="checkbox" id="registrada" name="registrada" style="background-color: white; color: #1e1f22; border-radius: 0;margin-top: 40px" {% if registrada == "on" %} checked {% endif %}>
                <label class="form-check-label" for="registrada" style="color:#1e1f22; margin-top: 35px">
                    Registrada
                </label>
            </div>
        </div>
        <div class="col-md-3">
            <div class="d-grid gap-2 mt-3" style="margin-left: -60px">
                <button type="submit" class="btn btn-primary btn-sm" value="filter" form="filter-form" name="action" style="width: 130px;height: 30px;margin-top:30px;background-color: rgb(84,160,39);border-color: rgb(84,160,39);border-radius: 0">Filtrar</button>
                <a type="reset" class="btn btn-secondary btn-sm" form="filter-form" name="action" value="clear" id="limpiar-filtros-btn" href="{% url 'listar_quejasU' %}" style="width: 130px;height: 30px; background-color: #444444;border-color:#444444;border-radius: 0 ">Limpiar</a>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-3">
            <div class="form-group" style="">
                <label for="dias" class="form-label" style="color: #1e1f22">Día:</label>
                <select name="dias" id="id_dias" class="form-select form-select-sm" style="background-color: white; color: #1e1f22; border-radius: 0; width: 300px;">
                          <option value="">Seleccionar</option>
                    <option value="01" {% if dia == "01" %} selected {% endif %} >1</option>
                  <option value="02" {% if dia == "02" %} selected {% endif %} >2</option>
                  <option value="03" {% if dia == "03" %} selected {% endif %} >3</option>
                  <option value="04" {% if dia == "04" %} selected {% endif %} >4</option>
                  <option value="05" {% if dia == "05" %} selected {% endif %} >5</option>
                  <option value="06" {% if dia == "06" %} selected {% endif %} >6</option>
                  <option value="07" {% if dia == "07" %} selected {% endif %} >7</option>
                  <option value="08" {% if dia == "08" %} selected {% endif %} >8</option>
                  <option value="09" {% if dia == "09" %} selected {% endif %} >9</option>
                  <option value="10" {% if dia == "10" %} selected {% endif %} >10</option>
                  <option value="11" {% if dia == "11" %} selected {% endif %} >11</option>
                  <option value="12" {% if dia == "12" %} selected {% endif %} >12</option>
                   <option value="13" {% if dia == "13" %} selected {% endif %} >13</option>
                <option value="14" {% if dia == "14" %} selected {% endif %} >14</option>
                  <option value="15" {% if dia == "15" %} selected {% endif %} >15</option>
                  <option value="16" {% if dia == "16" %} selected {% endif %} >16</option>
                  <option value="17" {% if dia == "17" %} selected {% endif %} >17</option>
                  <option value="18" {% if dia == "18" %} selected {% endif %} >18</option>
                  <option value="19" {% if dia == "19" %} selected {% endif %} >19</option>
                  <option value="20" {% if dia == "20" %} selected {% endif %} >20</option>
                  <option value="21" {% if dia == "21" %} selected {% endif %} >21</option>
                  <option value="22" {% if dia == "22" %} selected {% endif %} >22</option>
                  <option value="23" {% if dia == "23" %} selected {% endif %} >23</option>
                  <option value="24" {% if dia == "24" %} selected {% endif %} >24</option>
                  <option value="25" {% if dia == "25" %} selected {% endif %} >25</option>
                  <option value="26" {% if dia == "26" %} selected {% endif %} >26</option>
                  <option value="27" {% if dia == "27" %} selected {% endif %} >27</option>
                  <option value="28" {% if dia == "28" %} selected {% endif %} >28</option>
                  <option value="29" {% if dia == "29" %} selected {% endif %} >29</option>
                  <option value="30" {% if dia == "30" %} selected {% endif %} >30</option>
                  <option value="31" {% if dia == "31" %} selected {% endif %} >31</option>
                </select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group" style="">
                <label for="id_mes" class="form-label" style="color: #1e1f22">Mes:</label>
                <select name="mes" id="id_mes" class="form-select form-select-sm" style="background-color: white; color: #1e1f22; border-radius: 0; width: 350px;">
                    <option value="">Seleccionar</option>
                 <option value="01" {% if mes == "01" %} selected {% endif %}>Enero</option>
                 <option value="01" {% if mes == "01" %} selected {% endif %} >Enero</option>
                  <option value="02" {% if mes == "02" %} selected {% endif %} >Febrero</option>
                  <option value="03" {% if mes == "03" %} selected {% endif %} >Marzo</option>
                  <option value="04" {% if mes == "04" %} selected {% endif %} >Abril</option>
                  <option value="05" {% if mes == "05" %} selected {% endif %} >Mayo</option>
                  <option value="06" {% if mes == "06" %} selected {% endif %} >Junio</option>
                  <option value="07" {% if mes == "07" %} selected {% endif %} >Julio</option>
                  <option value="08" {% if mes == "08" %} selected {% endif %} >Agosto</option>
                  <option value="09" {% if mes == "09" %} selected {% endif %} >Septiembre</option>
                  <option value="10" {% if mes == "10" %} selected {% endif %} >Octubre</option>
                  <option value="11" {% if mes == "11" %} selected {% endif %} >Noviembre</option>
                  <option value="12" {% if mes == "12" %} selected {% endif %} >Diciembre</option>
                </select>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group" style="margin-left: 40px; width: 100px">
                <label for="id_years" class="form-label" style="color: #1e1f22; background-color: rgba(43,43,43,0)">Año:</label>
                <select name="years" id="id_years" class="form-select form-select-sm w-100" style="background-color: white; color: #1e1f22; border-radius: 0;">
                    {% for anno in anos %}
                        <option value="{{ anno }}" {% if anno == year %} selected {% endif %}> {{ anno }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-md-3">
            <div style="display: inline-block; border: 2px solid transparent; border-image: linear-gradient(to right, rgb(2,107,2), rgb(2,119,2), rgb(3,169,3), rgb(8,225,8), rgb(8,225,8)) 2 stretch; padding: 3px; margin-right: 10px; margin-left: -60px;margin-top: 25px">
                <a class="btn btn-secondary btn-sm" href="{% url 'insertar_quejasU' %}" style="width: 120px; height: 30px; background-color: rgba(13,115,81,0); border: none; color: #1e1f22;">Insertar Queja</a>
            </div>
        </div>
    </div>

</div>
</form>



















 {% for group in user.groups.all %}
          {% if  group.name == "Funcionario" %}
  <h2 style="color: #1e1f22;margin-left: 70px">Listado de quejas</h2>
    <h5 ><span class="badge badge-pill badge-primary text-body"  style="background: rgba(255,255,255,0.49);margin-left: 70px;border-radius: 0">Total de Quejas: {{ cantidad }}</span></h5>
 {% for group in user.groups.all %}
          {% if  group.name == "Funcionario" %}
  <table class="table table-striped" style="border: 1px solid #ffffff; border-bottom: 2px solid #ffffff;  color: white;max-width: 83%;margin-left: 90px">
    <thead>
      <tr style="background-image: linear-gradient(to left, rgba(84, 159, 39, 0.9), rgba(84, 159, 39, 0.75)); color: #1e1f22">
        <th scope="col" style="border: 1px solid white;">#</th>
        <th scope="col" style="border: 1px solid white;">Usuario</th>
        <th scope="col" style="border: 1px solid white;">Nombre y Apellidos</th>
        <th scope="col" style="border: 1px solid white;">Asunto</th>
        <th scope="col" style="border: 1px solid white;">Teléfono</th>
        <th scope="col" style="border: 1px solid white;">Dirección</th>
        <th scope="col"style="border: 1px solid white;">Fecha de creación</th>
        <th scope="col" style="border: 1px solid white;">Estado</th>
        <th scope="col" style="border: 1px solid white;">Accion</th>
      </tr>
    </thead>
    <tbody>
      {% for queja in quejas %}
        <tr>
          <th scope="row">{% if queja.queja_us %}{{ queja.queja_us.numero }}{% endif %}</th>
          <td style="color: #1e1f22">{{ queja.usuario.username }}</td>
          <td  style="color: #1e1f22">{{ queja.nombre_apellidos }}</td>
          <td  style="color: #1e1f22">{{ queja.asunto }}</td>
          <td  style="color: #1e1f22">{{ queja.telefono }}</td>
          <td  style="color: #1e1f22">{{ queja.direccion }}</td>
          <td  style="color: #1e1f22">{{ queja.created|date:"d/m/y" }}</td>
          <td  style="color: #1e1f22">{%  if queja.queja_us.respuesta %}
              {% if queja.queja_us.respuesta.entrega == True %}
                  Entregada
                  {% else %}
              Respondida
                  {% endif %}
          {% else %}
          {% if queja.queja_us.fechaT < now %}
              Atrasada
              {% else %}
              Asignada
          {% endif %}
          {% endif %}
          </td>
          <td>
                       {% if queja.pk %}
                            <div class="dropdown">
                            <button class="dropbtn" style="background-color: rgb(84,159,39);border-color: rgb(84,159,39);border-radius: 0">Accion</button>
                            <div class="dropdown-content" style="background-color: rgb(255,255,255); border-color: #2e4f1e">

                                {% if user == queja.usuario %}
                                    {% if not queja.queja_us %}
    <a  href="{% url 'editar_quejasU' pk=queja.pk %}" style="color: #1e1f22">Editar Queja</a>
      <a href="#" onclick="comprobacion('{{ queja.pk }}'); return false;">Eliminar Queja</a>
                                    {% endif %}
                                    {% endif %}

    <a  href="{% url 'ver_detalles' numero=queja.pk  %}" style="color: #1e1f22">Ver Detalles</a>

                            </div>
                            </div>
{% endif %}
                    </td>
        </tr>
      {% empty %}



      {% endfor %}
    </tbody>
  </table>
 {% endif %}
        {% endfor %}


{% endif %}
   {% endfor %}


    {% if not user.groups.all %}

    <div class="card-container" style="display: flex; flex-wrap: wrap; justify-content: center;">
  {% for queja in quejas %}
    <div class="card" style="width: 18rem; margin: 10px; background-color: white; color: #1e1f22;">
      <div class="card-body">
        <h5 class="card-title"># {% if queja.queja_us %}{{ queja.queja_us.numero }}{% endif %}</h5>
        <h6 class="card-subtitle mb-2 text-muted">Usuario: {{ queja.usuario.username }}</h6>
        <p class="card-text">Nombre y Apellidos: {{ queja.nombre_apellidos }}</p>
        <p class="card-text">Asunto: {{ queja.asunto }}</p>
        <p class="card-text">Fecha de creación: {{ queja.created|date:"d/m/y" }}</p>
        <p class="card-text">Estado:{%  if queja.queja_us.respuesta %}
              {% if queja.queja_us.respuesta.entrega == True %}
                  Entregada
                  {% else %}
              Respondida
                  {% endif %}
          {% else %}
          {% if queja.queja_us.fechaT < now %}
              Atrasada
              {% else %}
              {% if queja.queja_us %}
                  {% if queja.queja_us.modalidad.nombre == '1-Solicitud' or  queja.queja_us.modalidad.nombre == '2-Queja' or  queja.queja_us.modalidad.nombre == '3-Anonimo o Denuncia' or  queja.queja_us.modalidad.nombre == '5-Reclamacion' %}
              Asignada
                      {% else %}
                      {% endif %}
                  {% else %}
                  Por Tramitar
                  {% endif %}
          {% endif %}
          {% endif %}</p>
        {% if queja.pk %}
                            <div class="dropdown">
                            <button class="dropbtn" style="background-color: rgb(84,159,39);border-color: rgb(84,159,39);border-radius: 0">Accion</button>
                            <div class="dropdown-content" style="background-color: rgb(255,255,255); border-color: #2e4f1e">

                                {% if user == queja.usuario %}
                                    {% if not queja.queja_us %}
    <a  href="{% url 'editar_quejasU' pk=queja.pk %}" style="color: #1e1f22">Editar Queja</a>
    <a href="#" onclick="comprobacion('{{ queja.pk }}'); return false;">Eliminar Queja</a>
                                    {% endif %}
                                    {% endif %}

    <a  href="{% url 'ver_detalles' numero=queja.pk  %}" style="color: #1e1f22">Ver Detalles</a>

                            </div>
                            </div>
{% endif %}
      </div>
    </div>
  {% empty %}

    <div class="py-5 text-center" >

      <img class="d-block mx-auto mb-4"  src="{% static 'Autenticacion/login/img/S (3).png' %}" alt="" width="300" height="300" >
  <h4 style="color: #1e1f22">No hay quejas registradas</h4>
    </div>

  {% endfor %}
</div>

{% endif %}




    {% if page_obj.has_other_pages %}
  <nav aria-label="Navegación de página">
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1{% if search_params %}&amp;{{ search_params }}{% endif %}" aria-label="Primera" style="background-color: #ffffff; color: #1e1f22">
                    <span aria-hidden="true" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">&laquo;</span>
                    <span class="sr-only" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">Primera</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search_params %}&amp;{{ search_params }}{% endif %}" aria-label="Anterior" style="background-color: #ffffff; color: #1e1f22">
                    <span aria-hidden="true" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">&lsaquo;</span>
                    <span class="sr-only" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">Anterior</span>
                </a>
            </li>
        {% endif %}

        <li class="page-item disabled" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">
            <span class="page-link" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
            </span>
        </li>

        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search_params %}&amp;{{ search_params }}{% endif %}" aria-label="Siguiente" style="background-color: #ffffff; color: #1e1f22">

                    <span class="sr-only" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">Siguiente</span>
                <span aria-hidden="true" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">&rsaquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if search_params %}&amp;{{ search_params }}{% endif %}" aria-label="Última" style="background-color: #ffffff; color: #1e1f22">
                    <span aria-hidden="true" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">&raquo;</span>
                    <span class="sr-only" style="background-color: #ffffff; color: #1e1f22;border-radius: 0">Última</span>
                </a>
            </li>
        {% endif %}
    </ul>
  </nav>
{% endif %}




<div class="p-3"></div>




  <style>

  #mi-tabla.table-striped tr {
    color: #1e1f22;
}

  #mi-tabla.table-striped thead {
   background-image: linear-gradient(to left, rgba(84, 159, 39, 0.9), rgba(84, 159, 39, 0.75));
color: white;
}


  .dropdown {
        position: relative;
        display: inline-block;
    }

    .dropbtn {
        color: white;
        background-color: #007bff;
        padding: 4px 8px;
        font-size: 14px;
        border: none;
        cursor: pointer;
        border-radius: .25rem;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        z-index: 1;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        padding: 12px 16px;
    }

    .dropdown-content a {
        color: black;
        padding: 6px 0;
        text-decoration: none;
        display: block;
    }

    .dropdown:hover .dropdown-content {
        display: block;
    }


    th,
    td {
      vertical-align: middle!important;
    }
    .table {
      width: 100%;
      margin-bottom: 1rem;
      color: #1e1f22;
      border-collapse: collapse;
    }
    .table td,
    .table th {
      padding: 0.75rem;

    }
    .table thead th {
      vertical-align: bottom;

    }
    .table tbody+tbody {
      border-top: 2px solid #dee2e6;
    }
    .table .table {
      background-color: #fff;
    }
    .table-sm td,
    .table-sm th {
      padding: 0.3rem;
    }
  </style>



<h3 class="mb-0" ></h3>


<!-- Ventana modal -->
<div class="modal" id="reporte">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Eliminar Queja</h4>
        <button type="button" id="x" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
          <p style="font-size: 20px;margin-top: 10px">¿Estás seguro de que quieres eliminar la queja </p>
       <form method="post" action="" id="comprobacionForm">
            {% csrf_token %}

          <button type="submit" class="btn btn-danger mr-2" style="background-color: #54a027;border-color: #54a128;border-radius: 0" >Sí, eliminar</button>
            <button id="cancelarB" type="button" class="btn btn-secondary" style="background-color: #444444;border-color:#444444 ;border-radius: 0;">Cancelar</button>
        </form>
      </div>
    </div>
  </div>
</div>



<script>


  var cancelarB = document.getElementById("cancelarB");
  var cancelar = document.getElementById("x");

  // Agrega un evento de clic al botón
  cancelarB.addEventListener("click", function() {
    // Cierra la ventana modal

    $('#reporte').modal('hide');
  });

  cancelar.addEventListener("click", function() {
    // Cierra la ventana modal

    $('#reporte').modal('hide');
  });

</script>

    <script>
  function comprobacion(quejaId) {
    // Mostrar la ventana modal
    $('#reporte').modal('show');

    // Obtener la URL de redirección utilizando reverse() de Django
    var url = "{% url 'eliminar_quejaU' 0 %}"; // Reemplaza 'comprobacion' con el nombre de la ruta en tu archivo urls.py

    // Reemplazar el valor en el atributo action del formulario con la quejaId
    var form = document.getElementById('comprobacionForm');
    form.action = url.replace('0', quejaId);
  }
</script>

{% endblock %}